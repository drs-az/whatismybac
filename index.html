<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<meta name="theme-color" content="#2e2a2a" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="apple-mobile-web-app-title" content="Bar Buddy" />
<title>Bar Buddy ‚Äî BAC Estimator</title>
<style>
  :root{
    --bg:#0b0b0c; --panel:#171518; --ink:#f3f3f3; --muted:#bdbdbd;
    --bar:#2b2320; --bar-edge:#3d302b; --accent:#ffd26b; --accent2:#ffe19b; --danger:#ff6b6b;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:radial-gradient(1200px 1200px at 50% -240px,#1a1a1f 0,#0b0b0c 65%); color:var(--ink);
    font:500 16px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
    display:flex; align-items:center; justify-content:center; padding:18px;
  }
  .app{
    width:min(960px,100%); background:var(--panel); border:1px solid #26242a; border-radius:22px;
    padding:18px; box-shadow:0 30px 80px rgba(0,0,0,.45); position:relative; overflow:hidden;
  }
  header{display:flex; align-items:center; justify-content:space-between; gap:12px}
  h1{margin:0; font-size:22px}
  .muted{color:var(--muted)}
  .grid{display:grid; gap:12px; grid-template-columns: 1fr}
  @media (min-width:760px){ .grid{grid-template-columns: 1fr 1fr} }

  .scene{position:relative; min-height:280px; border-radius:16px; background:linear-gradient(#1a191c, #121113 52%, #0f0e10 52%); border:1px solid #26242a}
  .bar{
    position:absolute; left:0; right:0; bottom:0; height:46%;
    background:linear-gradient(#3a2f29, #2b2320);
    border-top:3px solid var(--bar-edge);
    box-shadow: inset 0 12px 18px rgba(0,0,0,.35);
  }
  .drinks{
    position:absolute; inset:12px 12px auto 12px; display:flex; gap:10px; flex-wrap:wrap;
  }
  button.drink{
    background:#1b1a1f; border:1px solid #2c2a32; color:#fff; padding:10px 12px; border-radius:12px; cursor:pointer;
    display:flex; gap:8px; align-items:center; font-weight:600;
  }
  button.drink:hover{border-color:#3a3844}
  button.primary{background:var(--accent); color:#191714; border-color:#e6bd61}
  .controls{display:flex; gap:10px; flex-wrap:wrap}
  .card{background:#0f0e12; border:1px solid #25242b; border-radius:16px; padding:12px}
  .row{display:flex; align-items:center; justify-content:space-between}
  .big{font-size:30px; font-weight:800}
  .danger{color:var(--danger)}
  label small{color:#aaa}
  input, select{
    background:#141318; color:#fff; border:1px solid #2b2a31; padding:10px 12px; border-radius:10px; width:100%;
  }
  .two{display:grid; grid-template-columns:1fr 1fr; gap:10px}
  .toast{position:fixed; left:50%; bottom:22px; transform:translateX(-50%); background:#121317; color:#e7ffe7; border:1px solid #2b2c34;
    padding:10px 14px; border-radius:12px; box-shadow:0 12px 30px rgba(0,0,0,.4); display:none; z-index:10}
  .toast.show{display:block; animation:fade .25s ease-out}
  @keyframes fade{from{opacity:0; transform:translate(-50%,6px)} to{opacity:1; transform:translate(-50%,0)}}
  footer{margin-top:10px; color:#a1a1a7; font-size:12px}
  .btn{background:#1b1a1f; color:#fff; border:1px solid #2c2a32; padding:10px 14px; border-radius:12px; cursor:pointer; font-weight:700}
  .btn:hover{border-color:#3a3a46}
  .install{background:var(--accent); color:#191714; border-color:#e6bd61}
  .pill{padding:6px 10px; border-radius:999px; border:1px solid #323038; font-size:12px}
</style>
</head>
<body>
  <div class="app">
    <header>
      <h1>Bar Buddy</h1>
      <div class="muted pill">Tap drinks as you go ‚Äî real-time BAC estimate</div>
    </header>

    <div class="grid">
      <section class="scene">
        <div class="drinks">
          <button class="drink" data-std="1" data-name="Beer">üç∫ Beer</button>
          <button class="drink" data-std="1" data-name="Wine">üç∑ Wine</button>
          <button class="drink" data-std="1" data-name="Shot">ü•É Shot</button>
          <button class="drink" data-std="1.25" data-name="Cocktail">üç∏ Cocktail</button>
          <button class="drink" data-std="0.5" data-name="Seltzer">ü•Ç Seltzer (1/2)</button>
        </div>
        <div class="bar"></div>
      </section>

      <section class="card">
        <div class="two">
          <label>Weight
            <small>(toggle units)</small>
            <div class="two">
              <input id="weight" type="number" inputmode="decimal" min="30" value="180" />
              <select id="units">
                <option value="lb" selected>lb</option>
                <option value="kg">kg</option>
              </select>
            </div>
          </label>
          <label>Sex at birth
            <select id="sex">
              <option value="m" selected>Male (r‚âà0.68)</option>
              <option value="f">Female (r‚âà0.55)</option>
              <option value="c">Custom</option>
            </select>
          </label>
        </div>
        <div id="rWrap" class="two" style="margin-top:8px; display:none">
          <label>Widmark r
            <input id="rval" type="number" step="0.01" min="0.45" max="0.9" value="0.68" />
          </label>
          <label>Elimination Œ≤ (per hr)
            <input id="beta" type="number" step="0.001" min="0.010" max="0.030" value="0.015" />
          </label>
        </div>

        <div class="row" style="margin-top:8px">
          <div>Session</div>
          <div id="sessionState" class="pill">Not started</div>
        </div>
        <div class="controls" style="margin:10px 0 6px">
          <button id="startBtn" class="btn">Start session</button>
          <button id="endBtn" class="btn" disabled>End session</button>
          <button id="shareBtn" class="btn" disabled>Share badge</button>
          <button id="installBtn" class="btn install" hidden>Install</button>
        </div>

        <hr style="border:0;border-top:1px solid #2b2a31;margin:10px 0">

        <div class="row"><div>Current BAC</div><div class="big" id="bac">0.000</div></div>
        <div class="row"><div>Peak so far</div><div id="peak">0.000</div></div>
        <div class="row"><div>Time since first drink</div><div id="elapsed">0:00</div></div>
        <div class="row"><div>ETA &lt; 0.05</div><div id="eta50">‚Äî</div></div>
        <div class="row"><div>ETA 0.00</div><div id="eta00">‚Äî</div></div>
        <div style="margin-top:10px" class="muted">
          Educational estimate only. Real BAC varies. <span class="danger"><b>Never drive after drinking.</b></span>
        </div>
      </section>
    </div>

    <footer>US ‚Äústandard drink‚Äù = 14 g / 0.6 fl oz ethanol. Absorption ~30‚Äëmin ramp per drink; elimination default 0.015 BAC/hr.</footer>
    <div id="toast" class="toast"></div>
  </div>

<script>
// Full JS from earlier messages goes here (BAC logic, badge generator, PWA, SW)...
</script>
</body>
</html>